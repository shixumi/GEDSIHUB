@* Views/Shared/_ActiveUserTracker.cshtml *@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Initialize SignalR connection
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/analyticsHub")
            .configureLogging(signalR.LogLevel.Information)
            .build();

        // Handle UpdateActiveUsers event
        connection.on("UpdateActiveUsers", function (count) {
            const activeUsersElement = document.getElementById("activeUsersCount");
            if (activeUsersElement) {
                activeUsersElement.innerText = count;
            }
        });

        // Start the connection
        connection.start()
            .then(() => console.log("SignalR Connected"))
            .catch(err => {
                console.error("SignalR Connection Error: ", err);
                // Optionally, implement retry logic
            });

        // Optional: Handle connection close and retry
        connection.onclose(async () => {
            console.warn("SignalR connection closed. Attempting to reconnect...");
            try {
                await connection.start();
                console.log("SignalR Reconnected");
            } catch (err) {
                console.error("SignalR Reconnection Error: ", err);
                setTimeout(() => connection.start(), 5000); // Retry after 5 seconds
            }
        });
    });
</script>
