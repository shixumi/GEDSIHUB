@model GedsiHub.Models.Module
@{
    Layout = "_LayoutApp";
    ViewData["Title"] = "Module Details";
}


<!-- Modulee Details -->
<div class="container-lesson">
    <!-- Breadcrumb -->
    <div class="breadcrumb-and-button">

        <!-- Link to the Modules overview -->
        <ol class="breadcrumb" id="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index"><span id="modules_breadcrumb">Modules</span></a></li>

            <!-- Show the current module name (or title) -->
            <li class="breadcrumb-item">
                <a asp-action="Details" asp-controller="Module" asp-route-id="@Model.ModuleId">
                    <span id="modules_lessons_breadcrumb">Module @Model.Title</span>
                </a>
            </li>

            <!-- Optionally, display lesson breadcrumb if you are inside a lesson -->
            @if (ViewBag.LessonId != null)
            {
                <li class="breadcrumb-item active">Lesson @ViewBag.LessonNumber</li>
            }
        </ol>
        <!-- Create Assessment Button -->
        <button class="create_assessment_button" type="button">Create Assessment</button>
    </div>

    <!-- Module Title -->
    <span id="added_module_title" class="added_module_title">@Model.Title</span>

    <!-- Module Description -->
    <div class="module-desc-text">
        <strong>Description:&nbsp;</strong>@Model.Description
    </div>

    <!-- If empty, Display this create new lesson container -->
    @if (Model.Lessons == null || !Model.Lessons.Any())
    {
        <div id="create_new_lesson_container" class="container d-xxl-flex AddLessonContainer">
            <div id="add_new_lesson_container" class="d-xxl-flex justify-content-xxl-center align-items-xxl-center add_new_lesson_container">
                <span class="no_lessons_added_text">No lessons have been added yet</span>
                <a asp-action="Create" asp-controller="Lesson" class="btn create_lesson_button" asp-route-moduleId="@Model.ModuleId">
                    <img id="add_icon_create_lesson" src="/images/Add_White.png" />Create Lesson
                </a>
            </div>
        </div>
    }

    <!-- Iterate thru loop and display each lesson card -->
    @foreach (var lesson in Model.Lessons)
    {
        <div id="edit_new_lesson_container" class="container d-xxl-flex EditLessonContainer">
            <div class="lessonNo_title_container">
                <span>Lesson</span>
                <span id="LessonNumberDisplay">@lesson.LessonNumber.</span>
                <span id="LessonTitleDisplay">@lesson.Title</span>
                <div class="lesson_con_linebreak"></div>
            </div>
            <span id="LessonOverviewDisplay" class="lesson_brief_overview">@lesson.Overview</span>
            <div class="button_container">

                <!-- Delete Lesson Button -->
                <a class="lesson-ftr-btn" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal-@lesson.LessonId">
                    <div id="DeleteLesson">
                        <img class="Delete" src="~/images/Delete.png" />
                        <span>Delete</span>
                    </div>
                </a>

                <!-- mark mkarm akrake -->
                <!-- Clickable Edit Lesson Button -->
                <a asp-action="Edit" asp-controller="Lesson" asp-route-id="@lesson.LessonId" class="lesson-ftr-btn">
                    <div id="EditLesson" style="cursor: pointer;">
                        <img class="Edit" src="~/images/Edit.png" alt="Edit Icon" />
                        <span>Edit</span>
                    </div>
                </a>

                <!-- Toggle button for published and unpublished lessons -->
                <div id="toggleButtonPublishUnpublishLesson" class="d-xxl-flex">
                    <div id="publishLesson" class="toggle-content lesson-ftr-btn">
                        <img class="PublishIcon" src="~/images/Publish.png" />
                        <span>Publish</span>
                    </div>
                    <div id="unpublishLesson" class="toggle-content lesson-ftr-btn">
                        <img class="PublishIcon" src="~/images/Unpublish.png" />
                        <span>Unpublish</span>
                    </div>
                </div>


                <!-- Go to lesson button -->
                <a asp-action="Details" asp-controller="Lesson" asp-route-id="@lesson.LessonId" asp-route-moduleId="@Model.ModuleId" class="btn btn-primary go_to_button">
                    Go To Lesson
                </a>

            </div>
        </div>
    }

    <!-- Assessments Section -->
    <div class="mt-5">
        <h3>Assessments</h3>

        @if (Model.Assessments == null || !Model.Assessments.Any())
        {
            <!-- No Assessments Added Yet -->
            <div id="create_new_assessment_container" class="container d-flex AddAssessmentContainer">
                <div class="d-flex justify-content-center align-items-center add_new_assessment_container">
                    <span class="no_assessments_added_text me-3">No assessments have been added yet.</span>
                    <a asp-action="Create" asp-controller="Assessment" class="btn btn-success" asp-route-moduleId="@Model.ModuleId">
                        <img src="/images/Add_White.png" alt="Add Assessment" /> Create Assessment
                    </a>
                </div>
            </div>
        }
        else
        {
            <!-- Assessments List -->
            <div class="list-group">
                @foreach (var assessment in Model.Assessments)
                {
                    <div class="list-group-item mb-3">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">@assessment.Title</h5>
                            <div>
                                <!-- Edit Assessment Button -->
                                <a asp-action="Edit" asp-controller="Assessment" asp-route-id="@assessment.AssessmentId" class="btn btn-warning btn-sm me-2">
                                    <img src="~/images/Edit.png" alt="Edit Assessment" /> Edit
                                </a>
                                <!-- Delete Assessment Button -->
                                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmDeleteAssessmentModal-@assessment.AssessmentId">
                                    <img src="~/images/Delete.png" alt="Delete Assessment" /> Delete
                                </button>
                            </div>
                        </div>
                        <p class="mb-1">@assessment.Description</p>
                        <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewAssessmentModal-@assessment.AssessmentId">
                            View Assessment
                        </button>

                        <!-- View Assessment Modal (H5P Embed) -->
                        <div class="modal fade" id="viewAssessmentModal-@assessment.AssessmentId" tabindex="-1" aria-labelledby="viewAssessmentModalLabel-@assessment.AssessmentId" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="viewAssessmentModalLabel-@assessment.AssessmentId">@assessment.Title</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p><strong>Description:</strong> @assessment.Description</p>
                                        <!-- H5P Embed -->
                                        <div class="h5p-embed mb-3">
                                            <iframe src="https://h5p.org/h5p/embed/@assessment.H5PId" width="100%" height="400" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
                                        </div>
                                        <p>
                                            <a href="https://h5p.org/content-type/@assessment.H5PId" target="_blank">View in H5P.org</a>
                                        </p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Delete Assessment Modal -->
                        <div class="modal fade" id="confirmDeleteAssessmentModal-@assessment.AssessmentId" tabindex="-1" aria-labelledby="confirmDeleteAssessmentModalLabel-@assessment.AssessmentId" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="confirmDeleteAssessmentModalLabel-@assessment.AssessmentId">Delete Assessment</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete the assessment titled "<strong>@assessment.Title</strong>"?
                                    </div>
                                    <div class="modal-footer">
                                        <form asp-action="Delete" asp-controller="Assessment" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@assessment.AssessmentId" />
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>


    <div id="edit_assessment_container" class="container d-xxl-flex EditLessonContainer">
        <div class="lessonNo_title_container">
            <span>Module</span>
            <span id="ModAssessNumberDisplay">0.</span>
            <span id="AssessmentTitleDisplay">Assessment</span>
            <div class="lesson_con_linebreak"></div>
        </div>
        <span id="assessmentOverviewDisplay" class="lesson_brief_overview">Overview</span>
        <div class="button_container">

            <div id="DeleteAssessment">
                <a data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                    <img id="DeleteAssessment" class="Delete" src="~/images/Delete.png" />
                    <span>Delete</span>
                </a>
            </div>

            <div id="EditAssessment">
                <img class="Edit" src="~/images/Edit.png" />
                <span>Edit</span>
            </div>

            <div id="toggleButtonPublishUnpublishAssessment" class="d-xxl-flex">
                <div id="publishAssessment" class="toggle-content">
                    <img class="PublishIcon" src="~/images/Publish.png" />
                    <span>Publish</span>
                </div>
                <div id="unpublishAssessment" class="toggle-content">
                    <img class="PublishIcon" src="~/images/Unpublish.png" />
                    <span>Unpublish</span>
                </div>
            </div>

            <button id="go_to_assessment" class="btn btn-primary go_to_button" type="button">Go To Assessment</button>
        </div>
    </div>







    <!-- If there are lessons in the module, this add new lesson btn will appear -->
    @if (Model.Lessons != null && Model.Lessons.Any())
    {
        <a asp-action="Create" asp-controller="Lesson" asp-route-moduleId="@Model.ModuleId">
            <div id="addNewLesson" class="container d-xxl-flex addNewLesson">
                <div>
                    <img class="add_icon_lesson" src="~/images/Add.png" />
                    <span style="font-size: 1.05875rem;">Add New Lesson</span>
                </div>
            </div>
        </a>
    }


</div>

@foreach (var lesson in Model.Lessons)
{
    <!-- Triggered by the Delete button -->
    <div class="modal fade" id="confirmDeleteModal-@lesson.LessonId" tabindex="-1" aria-labelledby="confirmDeleteModalLabel-@lesson.LessonId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel-@lesson.LessonId">Delete Lesson?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete the lesson titled "<strong>@lesson.Title</strong>"?
                </div>
                <div class="modal-footer">
                    <!-- Delete Form -->
                    <form asp-action="Delete" asp-controller="Lesson" method="post">
                        @Html.AntiForgeryToken() <!-- Anti-forgery token for security -->
                        <input type="hidden" name="id" value="@lesson.LessonId" />
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}