@model GedsiHub.Models.Assessment

@{
    Layout = "_LayoutApp";
    ViewData["Title"] = "Take the Assessment";
}

<!-- Assessment Details Page -->
<div>
    <!-- Breadcrumbs -->
    <ol class="breadcrumb" id="breadcrumb">
        <li class="breadcrumb-item">
            <!-- Link to the list of modules -->
            <a asp-controller="Module" asp-action="Index"><span>Modules</span></a>
        </li>
        <li class="breadcrumb-item">
            <!-- Link to the module details page -->
            <a asp-action="Details" asp-controller="Module" asp-route-id="@ViewBag.ModuleId">
                <span id="module_number" class="module_number">@ViewBag.ModuleTitle</span>
            </a>
        </li>
        <!-- Current assessment title -->
        <li class="breadcrumb-item">
            <span id="cms_lesson_breadcrumb">Lesson <span id="lesson_number" class="module_number">@Model.Title</span></span>
        </li>
    </ol>

    <!-- Assessment Title -->
    <span id="added_module_title" class="added_module_title">@Model.Title</span>

    <!-- White Container for the assessment content -->
    <div class="cms_white_base_container">
        <!-- Preview of the H5P content -->
        @if (!string.IsNullOrEmpty(Model.H5PEmbedCode))
        {
            <div id="responsive-iframe" class="embed-responsive responsive-iframe">
                @Html.Raw(Model.H5PEmbedCode)
            </div>
        }

        <!-- Assessment Submission Form -->
        <form asp-action="Submit" asp-controller="Assessment" method="post" id="assessmentForm">
            @Html.AntiForgeryToken()

            <!-- Hidden field to pass the Assessment ID -->
            <input type="hidden" name="assessmentId" value="@Model.AssessmentId" />

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary mt-3" id="submitAssessmentBtn">Submit Assessment</button>
        </form>

        <!-- Buttons for managing assessment content (if user is Admin) -->
        @if (User.IsInRole("Admin"))
        {
            <div class="lesson_content_buttons">
                <!-- Edit Button (Using ASP.NET Route Helpers) -->
                <a asp-action="Edit" asp-controller="Assessment" asp-route-id="@Model.AssessmentId" class="editLessonContentButton">
                    <i class="f-icon la la-edit"></i> Edit
                </a>

                <!-- Delete Button as a Form -->
                <form asp-action="DeleteConfirmed" asp-controller="Assessment" method="post" class="d-inline">
                    @Html.AntiForgeryToken() <!-- Include Anti-Forgery Token for security -->
                    <input type="hidden" name="id" value="@Model.AssessmentId" />
                    <button type="submit" class="deleteLessonContentButton">
                        <i class="f-icon la la-trash"></i> Delete
                    </button>
                </form>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var submitBtn = document.getElementById('submitAssessmentBtn');
            var assessmentForm = document.getElementById('assessmentForm');

            submitBtn.addEventListener('click', function (event) {
                // Optional: Add any pre-submission validation here
                // For example, ensure that the user has interacted with the H5P content

                // Confirm submission
                var confirmSubmit = confirm("Are you sure you want to submit the assessment?");
                if (!confirmSubmit) {
                    event.preventDefault(); // Prevent form submission if user cancels
                }
            });
        });
    </script>
}
